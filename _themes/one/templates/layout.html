<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
	<meta name="description" content="崮生的学习笔记记录站点，在这里将涉及到有关编程的一些知识。
      其中大部分是关于ECMAScript的">
	<meta name="google-site-verification" content="zryWPE68mHndlirad-4TTJ5WwbpROalM2XmIv9VU3Oo" />
	<meta name="baidu-site-verification" content="ZtTgMLojrB" />
	<meta charset="utf-8">
	<meta name="theme-color" content="#673ab8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="{{system.name}} {{system.version}}">
	<meta name="theme" content="{{theme.name}} {{theme.version}}">
	<title>崮生 {% block title%}{% endblock %}</title>
	<script>
		// if ('serviceWorker' in navigator) {
		// 	window.addEventListener('load', function () {
		// 		navigator.serviceWorker.register('/sw.js', { scope: '/' })
		// 			.then(function (registration) {
		// 				console.log('ServiceWorker registration successful with scope: ', registration.scope);
		// 			})
		// 			.catch(function (err) {
		// 				console.log('ServiceWorker registration failed: ', err);
		// 			});
		// 	});
		// }
	</script>
	{%- if config.touchIcon %}
	<link rel="apple-touch-icon" href="{{ config.touchIcon }}" />
	{%- endif %}
	{%- if config.feedurl %}
	<link rel="alternate" type="application/rss+xml" href="{{config.feedurl}}" title="{{config.sitename}}" />
	{%- endif %}
	<link rel="stylesheet" href="{{static_url('one.css')}}" />
	{%- block afterstyle %}{% endblock %}
	{%- if config.google %}
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', '{{config.google}}']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_trackPageLoadTime']);
	</script>
	{%- endif %}
	<link rel="shortcut icon" href="{{ static_url('favicon.ico') }}" type="image/x-icon">
	<link rel="stylesheet" href="{{ static_url('default.min.css') }}">
	<style>
		/** 运行按钮的定位 */
		.highlight {
			position: relative;
			clear: both;
		}

		.run-script {
			background-color: antiquewhite;
			position: absolute;
			padding: 2px 10px;
			border-radius: 5px;
			top: 6px;
			right: 6px;
		}

		/** 可编辑的元素的样式 */
		pre[contenteditable=true] {
			border: 2px solid #1b76c4;
			border-left-width: 4px;
			border-left-color: #1b76c4;
			box-shadow: inset 0 2px 2px -2px rgba(0, 0, 0, .2);
			border-radius: 0px;
			outline: 0px;
		}
	</style>
	<script src="{{ static_url('highlight.min.js') }}"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-139738006-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'UA-139738006-1');
	</script>
</head>

<body>
	<div class="header">
		<div class="container">
			<div class="brand">
				<a class="home" href="{{content_url('index.html')}}">{{config.sitename}}</a>
				{%- if config.tagline %}
				- <span class="tagline">{{ config.tagline }}</span>
				{%- endif %}
			</div>
			{%- if config.navigation %}
			<div class="menu" role="navigation">
				{%- for item in config.navigation %}
				<a href="{{content_url(item.link)}}">{{item.title}}</a>
				{%- endfor %}
			</div>
			{%- endif %}
		</div>
	</div>
	<div class="document yue">
		{%- block document %}
		{%- endblock %}
	</div>
	<div class="footer" style="clear: both;">
		{%- if config.footer %}
		{{config.footer}}
		{%- endif %}
		{%- if not config.hideNico %}
		<p class="copyright">powered by <a href="{{system.homepage}}">{{system.name}}</a> {{system.version}}</p>
		{%- endif %}
		<a href="https://shenzilong.cn/blog/feed">
			<img style="height: 16px" src="{{ static_url('feed.png') }}" alt="rss订阅">
		</a>
	</div>
	{%- if config.github %}
	<div class="github">
		<a class="github-link" href="{{config.github}}" title="存放一些我的代码">代码库-git</a>
	</div>
	{%- endif %}
	<script src="{{ static_url('one.js') }}"></script>

</body>

</html>

<script>
	window.addEventListener('load', function () {
		//因为md文档中直接链接到其他文件会导致没有.html 后缀然后访问不到资源，故出此下策
		let href = Array.from(document.querySelectorAll('p a[href]'))
		let yearReg = new RegExp(location.origin + '\/\\d\\d\\d\\d(.*)')
		href.forEach(v => {
			//去除 2019 这样的年份中缀
			if (yearReg.test(v.href))
				v.href = location.origin + v.href.match(yearReg)[1]
		})

		//高亮代码块
		document.querySelectorAll('pre').forEach(function (value) {
			hljs.highlightBlock(value);
			/** 输入代码并实时运行 */
			if (value.parentElement.previousSibling === null) {/** 是第一个元素 */
				return;
			}

			if (value.parentElement.previousSibling.classList.contains('highlight') === false)
				value.setAttribute("contenteditable", "true");
			if (value.querySelector('code.javascript') !== null && value.parentElement.previousSibling.classList.contains('highlight') === false) {
				const el= getRunScript(value)
				value.appendChild(el)

				value.insertBefore(el,value.children[0])
			}
		})
		function getRunScript(target) {
			const el = document.createElement('div')
			el.classList.add('run-script')
			el.textContent = '运行'
			el.setAttribute("contenteditable", "false");
			return el
		}

		/** 可以实时运行这些输入的代码 */
		document.querySelector('body').addEventListener('click', function (e) {
			const el = e.target
			if (el.classList.contains("run-script")===false)
				return;
				console.log(el.parentElement);

			const target=el.parentElement
			const code = target.innerText.slice(el.innerText.length)
			console.log('run code ==>' + code);
			eval(code)
		})

		/** 可以实时运行这些输入的代码 */
		document.querySelector('body').addEventListener('input', function (e) {
			const el = e.target
			if (el instanceof HTMLPreElement === false)
				return;
			const previousSibling = el.parentElement.previousSibling
			if (previousSibling.classList.contains('nico-insert-code') || previousSibling instanceof HTMLStyleElement) {/** 前面那个节点的内容是由el中的内容生成的 */
				previousSibling.innerHTML = el.textContent

				// hljs.highlightBlock(el);
			}
		})

		/** 失去焦点之后重新渲染代码 */
		document.querySelector('body').addEventListener('focusout', function (e) {
			const el = e.target
			if (el instanceof HTMLPreElement === false)
				return;
			hljs.highlightBlock(el);
		})

		/** table 转变为4个空格 */
		// document.addEventListener('keydown', function (e) {
		// 	if (e.keyCode === 9) {
		// 		const el = e.target
		// 		const code=el.innerText
		// 		const CursortPosition= getCursortPosition(el)
		// 		console.log(el);

		// 		el.innerText=code.slice(0,CursortPosition)+"    "+code.slice(CursortPosition)
		// 		setCaretPosition(el, 0)
		// 		e.preventDefault();
		// 	}
		// }, false);

		/** 获取当前光标位置 */
		function getCursortPosition(element) {
			var caretOffset = 0;
			var doc = element.ownerDocument || element.document;
			var win = doc.defaultView || doc.parentWindow;
			var sel;
			if (typeof win.getSelection != "undefined") {//谷歌、火狐
				sel = win.getSelection();
				if (sel.rangeCount > 0) {//选中的区域
					var range = win.getSelection().getRangeAt(0);
					var preCaretRange = range.cloneRange();//克隆一个选中区域
					preCaretRange.selectNodeContents(element);//设置选中区域的节点内容为当前节点
					preCaretRange.setEnd(range.endContainer, range.endOffset);  //重置选中区域的结束位置
					caretOffset = preCaretRange.toString().length;
				}
			} else if ((sel = doc.selection) && sel.type != "Control") {//IE
				var textRange = sel.createRange();
				var preCaretTextRange = doc.body.createTextRange();
				preCaretTextRange.moveToElementText(element);
				preCaretTextRange.setEndPoint("EndToEnd", textRange);
				caretOffset = preCaretTextRange.text.length;
			}
			return caretOffset;
		}


	})
	/** 设置光标位置 */
		function setCaretPosition(element, pos) {
			var range, selection;
			if (document.createRange)//Firefox, Chrome, Opera, Safari, IE 9+
			{
				range = document.createRange();//创建一个选中区域
				range.selectNodeContents(element);//选中节点的内容
				if (element.innerHTML.length > 0) {
					range.setStart(element.children[0], pos); //设置光标起始为指定位置
				}
				range.collapse(true);       //设置选中区域为一个点
				selection = window.getSelection();//获取当前选中区域
				selection.removeAllRanges();//移出所有的选中范围
				selection.addRange(range);//添加新建的范围
			}
			else if (document.selection)//IE 8 and lower
			{
				range = document.body.createTextRange();//Create a range (a range is a like the selection but invisible)
				range.moveToElementText(element);//Select the entire contents of the element with the range
				range.collapse(false);//collapse the range to the end point. false means collapse to end rather than the start
				range.select();//Select the range (make it the visible selection
			}
		}
</script>