## 功能
{: id="20210325155354-beump17" updated="20210325155401"}

#想法# 或许可以使用类似于 AutoHotkey 这样的工具来监听输入 `[[`
然后弹出和在思源内部使用一样的列表
{: id="20210325154243-1anw3ci" updated="20210325155417"}

![图片.png](assets/图片-c4e22a64-20210325154243-1f8tw7k.png)
{: id="20210325154243-8dllnq9" updated="20210325155415"}

当用户选择后，在当前输入框填充入 [ html链接 | md格式链接 | 文本 ] 。
{: id="20210325154243-eegmj93"}

## 场景畅想
{: id="20210325154243-yx02rdk"}

- {: id="20210325154258-694udvx"}在聊天应用的输入框直接输入 【【 就可以搜索自己笔记本中的内容然后填充进去
  {: id="20210325154258-ym9n3bv" updated="20210325154347"}
{: id="20210325154243-ovwdam4" updated="20210325154258"}

## 实现思路
{: id="20210325155044-2y0lnwv" updated="20210325202629"}

- {: id="20210325202632-kdeakxo"}监听用户按键
  {: id="20210325202632-8cxirg3" updated="20210325202639"}

  - {: id="20210325212640-hmuiw91"}[iohook 这个库可以监听按键](https://wilix-team.github.io/iohook/os-support.html)
    {: id="20210325212640-0w6jt65" updated="20210325212702"}
  {: id="20210325212640-zl768s4"}
- {: id="20210325202641-ww360ls"}读取输入框内容，从后向前获取一定长度文本
  {: id="20210325202641-7qfge3q" updated="20210325202744"}
- {: id="20210325202745-s5t2qxz"}判断文本是否符合模式`[[text`
  {: id="20210325202745-acxtzsi" updated="20210325202806"}
- {: id="20210325202807-kd6l0hn"}通过 api 检索 text ，显示列表
  {: id="20210325202807-vrntzvn" updated="20210325202833"}
- {: id="20210325202834-nmy7f9l"}移动列表到离输入框合适的地方
  {: id="20210325202834-7ugebus" updated="20210325202852"}
- {: id="20210325202901-g4luqja"}用户选择项目后通过 粘贴 来将文本填进去
  {: id="20210325202901-vreed6k" updated="20210325202926"}
{: id="20210325202629-yef3pqm" updated="20210325212640"}

### 采坑记录
{: id="20210325222819-2mcycpz" updated="20210325222826"}

- {: id="20210325222827-mabk9in"}打算使用 N-API 的方式来将用户按键以及当前焦点框传给其他程序
  {: id="20210325222827-a19n71a" updated="20210325222857"}

  - {: id="20210325222857-df0h4b6"}在走一个 N-API 的 [hello word 程序](https://www.jianshu.com/p/6b0d60672e04)的时候报错 `C:\\Users\\llej\\AppData\\Local\\node-gyp\\Cache\\14.5.0\\x64\\node.lib : fatal error LNK1127: 库已损坏 [D:\code\quote\packages\i`
    {: id="20210325222857-4ngu2hh" updated="20210325223448"}
  - {: id="20210325222951-t15ofra"}搜索了一下发现可能是 node.lib 不对劲，于是去 https://nodejs.org/download/release/v14.5.0/win-x64/ 这里下载对应版本的 node.lib
    {: id="20210325222951-s1k0cy2" updated="20210325223035"}

    - {: id="20210325223037-fzbwwga"}浏览器直接打开了新标签....
      {: id="20210325223037-2z2cpwn" updated="20210325223050"}
    - {: id="20210325223053-f4o1k6m"}F12 修改 a 标签给他加上 download 属性
      {: id="20210325223053-cid0yby" updated="20210325223128"}
    {: id="20210325223037-93e6ykg"}
  - {: id="20210325223131-c8fe3xp"}下载后替换成功编译
    {: id="20210325223129-q90trbx" updated="20210325223138"}
  - {: id="20210325223158-vlcqss4"}![node.lib 前后对比](assets/image-20210325223158-t0pehz0.png)
    {: id="20210325223158-x0jqdb9" updated="20210325223218"}
  {: id="20210325222858-b5uslmx"}
{: id="20210325222826-bndkjsm" updated="20210325223448"}

## 文章分享到的地方
{: id="20210325155155-2wk7rxv" updated="20210325155208"}

[https://ld246.com/article/1616658417483](https://ld246.com/article/1616658417483)
{: id="20210325155155-09h2p42" updated="20210325155217"}

{: id="20210325155209-p2dpb34"}


{: id="20210325154235-xo42dww" type="doc"}
